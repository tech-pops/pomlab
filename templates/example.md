## Proxmox

Find the proper driver at the [NVidia website](https://www.nvidia.com/download/index.aspx?lang=en-us).

**Note: Make sure to select "Linux 64-bit" as your OS**

![](https://i.imgur.com/TaZBMK4.png)

Hit the "Search" button.

![](https://i.imgur.com/jrm6API.png)

Hit the "Download" button.

![](https://i.imgur.com/QsxIBKH.png)

**Right-click** the download button and "Copy link address".

![](https://i.imgur.com/ZKAnrGO.png)

SSH into to your Proxmox instace.

Create the file `/etc/modprobe.d/nvidia-installer-disable-nouveau.conf` with the following contents:

```
# generated by nvidia-installer
blacklist nouveau
options nouveau modeset=0
```

Reboot the machine:
```Bash
reboot now
```

Run the following:
```Bash
apt install build-essential pve-headers-$(uname -r)
wget <link you copied>
chmod +x ./NVIDIA-Linux-x86_64-<VERSION>.run
./NVIDIA-Linux-x86_64-<VERSION>.run
```

Edit `/etc/modules-load.d/modules.conf` and add the following to the end of the file:
```
nvidia
nvidia_uvm
```

![](https://i.imgur.com/AuhYt4h.png)

Run the following:
```Bash
update-initramfs -u
```

![](https://i.imgur.com/rWJ6UQB.png)

Create the file `/etc/udev/rules.d/70-nvidia.rules` and add the following:

```
# /etc/udev/rules.d/70-nvidia.rules
# Create /nvidia0, /dev/nvidia1 â€¦ and /nvidiactl when nvidia module is loaded
KERNEL=="nvidia", RUN+="/bin/bash -c '/usr/bin/nvidia-smi -L && /bin/chmod 666 /dev/nvidia*'"
# Create the CUDA node when nvidia_uvm CUDA module is loaded
KERNEL=="nvidia_uvm", RUN+="/bin/bash -c '/usr/bin/nvidia-modprobe -c0 -u && /bin/chmod 0666 /dev/nvidia-uvm*'"
```

![](https://i.imgur.com/NRGOWgy.png)

Reboot the machine.

### For each container

SSH into the Proxmox.

Run the following:
```Bash
modprobe nvidia-uvm
ls /dev/nvidia* -l
```

![](https://i.imgur.com/mOHirL5.png)

**Note these numbers, you'll need them in the next step**
![](https://i.imgur.com/DU6fMSY.png)

Edit `/etc/pve/lxc/<container ID>.conf` and add the following:
```
lxc.cgroup.devices.allow: c <number from previous step>:* rwm
lxc.cgroup.devices.allow: c <number from previous step>:* rwm
lxc.cgroup.devices.allow: c <number from previous step>:* rwm
lxc.mount.entry: /dev/nvidia0 dev/nvidia0 none bind,optional,create=file
lxc.mount.entry: /dev/nvidiactl dev/nvidiactl none bind,optional,create=file
lxc.mount.entry: /dev/nvidia-uvm dev/nvidia-uvm none bind,optional,create=file
lxc.mount.entry: /dev/nvidia-modeset dev/nvidia-modeset none bind,optional,create=file
lxc.mount.entry: /dev/nvidia-uvm-tools dev/nvidia-uvm-tools none bind,optional,create=file
lxc.mount.entry: /dev/nvidia-uvm-tools dev/nvidia-caps/nvidia-cap1 none bind,optional,create=file
lxc.mount.entry: /dev/nvidia-uvm-tools dev/nvidia-caps/nvidia-cap2 none bind,optional,create=file
```

![](https://i.imgur.com/kNkfzyP.png)

## Container/LXC

SSH into your container.

Run the following:
```Bash
dpkg --add-architecture i386
apt update
apt install libc6:i386

wget <link you copied for the Proxmox step>
chmod +x ./NVIDIA-Linux-x86_64-<VERSION>.run
./NVIDIA-Linux-x86_64-<VERSION>.run --no-kernel-module
```

Reboot the container.

### CUDA

SSH back into your container.

Run the following:
```Bash
apt install nvidia-cuda-toolkit nvidia-cuda-dev
```

**Note: Plex DOES NOT USE THE GPU until you install CUDA**

Plex will pick up the fact that you have a GPU in the install process and will enable the hardware transcoding checkbox, but it will NOT use the GPU until CUDA is installed.

### Python/cuDNN

SSH into your container.

Run the following:
```Bash
apt install python3 python3-dev python3-pip python3-pycuda
```

Check your CUDA version:
```Bash
nvidia-smi
```

![](https://i.imgur.com/ZTOSjDP.png)

Download the correct cuDNN library from the [NVidia website](https://developer.nvidia.com/rdp/cudnn-download) (requires creating an account, but it's free).

![](https://i.imgur.com/7bgDqs8.png)

Upload it to your container.

![](https://i.imgur.com/DzjQWwI.png)

![](https://i.imgur.com/EbMOgbq.png)


Run the following:
```Bash
tar -xvf cudnn-<tab>
mkdir -p /usr/local/cuda/lib64/
mkdir -p /usr/local/cuda/include/
cp cuda/lib64/* /usr/local/cuda/lib64/
cp cuda/include/* /usr/local/cuda/include/
export CUDA_ROOT=/usr/local/cuda
export LD_LIBRARY_PATH=$CUDA_ROOT/lib64:$LD_LIBRARY_PATH
export CPATH=$CUDA_ROOT/include:$CPATH
export LIBRARY_PATH=$CUDA_ROOT/lib64:$LIBRARY_PATH
echo "export CUDA_ROOT=/usr/local/cuda" >> .bashrc
echo "export LD_LIBRARY_PATH=\$CUDA_ROOT/lib64:\$LD_LIBRARY_PATH" >> .bashrc
echo "export CPATH=\$CUDA_ROOT/include:\$CPATH" >> .bashrc
echo "export LIBRARY_PATH=\$CUDA_ROOT/lib64:\$LIBRARY_PATH" >> .bashrc
```

Done!
